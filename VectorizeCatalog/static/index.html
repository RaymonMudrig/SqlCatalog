<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SQL Catalog Analysis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/styles.css" />
  <link rel="stylesheet" href="/static/cluster.css" />
  <link rel="stylesheet" href="/static/diagram.css" />
  <link rel="stylesheet" href="/static/markdown_diff.css" />

  <!-- Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" crossorigin="anonymous"></script>

  <!-- Diff rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html.min.js"></script>

  <!-- SQL syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
</head>
<body>
  <!-- Top Panel -->
  <header id="top-panel">
    <h1>SQL Catalog Analysis</h1>
    <div class="prompt-container">
      <textarea id="semantic-prompt" placeholder="Ask about entities, compare SQL, or manage clusters..."></textarea>
      <button id="prompt-submit" type="button">Ask</button>
    </div>
    <button id="settings-btn" type="button" title="Settings">⚙️</button>
  </header>

  <!-- Main Content Area -->
  <main>
    <!-- Left Panel with Tabs -->
    <aside id="left-panel">
      <div class="tab-header">
        <button class="tab-btn active" data-tab="entities">Entities</button>
        <button class="tab-btn" data-tab="clusters">Clusters</button>
      </div>

      <!-- Entities Tab -->
      <div id="tab-entities" class="tab-content active">
        <input type="text" id="entity-search" placeholder="Search entities..." />
        <div id="entity-list" class="entity-sections">
          <div class="entity-section" data-kind="tables">
            <div class="section-header">
              <h3>Tables</h3>
              <span class="count">0</span>
            </div>
            <ul class="entity-list"></ul>
          </div>
          <div class="entity-section" data-kind="procedures">
            <div class="section-header">
              <h3>Procedures</h3>
              <span class="count">0</span>
            </div>
            <ul class="entity-list"></ul>
          </div>
          <div class="entity-section" data-kind="views">
            <div class="section-header">
              <h3>Views</h3>
              <span class="count">0</span>
            </div>
            <ul class="entity-list"></ul>
          </div>
          <div class="entity-section" data-kind="functions">
            <div class="section-header">
              <h3>Functions</h3>
              <span class="count">0</span>
            </div>
            <ul class="entity-list"></ul>
          </div>
        </div>
        <button id="clear-entities" type="button">Clear All</button>
      </div>

      <!-- Clusters Tab -->
      <div id="tab-clusters" class="tab-content">
        <div id="cluster-list-container">
          <ul id="cluster-list"></ul>
        </div>

        <!-- Trash Section -->
        <div id="trash-section">
          <div class="trash-header">
            <h3>Trash</h3>
            <button id="trash-toggle-btn" type="button">▼</button>
          </div>
          <div id="trash-content" class="trash-content" style="display: none;">
            <p class="trash-empty">No items in trash</p>
          </div>
          <div id="trash-actions" style="display: none;">
            <button id="empty-trash-btn" type="button" class="danger-btn">Empty Trash</button>
          </div>
        </div>

        <!-- Entity Action Panel (shown when entity is selected) -->
        <div id="entity-action-panel" style="display: none;"></div>

        <!-- Cluster Controls -->
        <div id="cluster-controls">
          <div class="control-section hidden" id="rename-cluster-section">
            <h4>Rename Cluster</h4>
            <select id="rename-cluster-select"></select>
            <input type="text" id="rename-cluster-input" placeholder="New name..." />
            <button id="rename-cluster-btn" type="button">Rename</button>
          </div>

          <div class="control-section hidden" id="rename-group-section">
            <h4>Rename Group</h4>
            <select id="rename-group-select"></select>
            <input type="text" id="rename-group-input" placeholder="New name..." />
            <button id="rename-group-btn" type="button">Rename</button>
          </div>

          <div class="control-section hidden" id="move-group-section">
            <h4>Move Group</h4>
            <select id="move-group-select"></select>
            <select id="move-group-target"></select>
            <button id="move-group-btn" type="button">Move</button>
          </div>

          <div class="control-section hidden" id="move-procedure-section">
            <h4>Move Procedure</h4>
            <select id="move-procedure-select"></select>
            <select id="move-procedure-target"></select>
            <button id="move-procedure-btn" type="button">Move</button>
          </div>

          <p class="hint" id="cluster-hint">Select a cluster or entity to show controls</p>
        </div>
      </div>
    </aside>

    <!-- Content Panel -->
    <section id="content-panel">
      <!-- Notification Bar -->
      <div id="notification-bar" class="notification-bar hidden">
        <div class="notification-content">
          <span class="notification-icon"></span>
          <span class="notification-message"></span>
        </div>
        <button class="notification-close" onclick="hideNotification()">&times;</button>
      </div>

      <div id="content-area">
        <div id="welcome">
          <h2>Welcome to SQL Catalog Analysis</h2>
          <p>Use the semantic prompt above to:</p>
          <ul>
            <li>Search for entities: "show me order tables"</li>
            <li>Compare SQL: "compare dbo.Order with dbo.Order_Archive"</li>
            <li>Manage clusters: "rename cluster C1 to Orders"</li>
            <li>View relationships: "which procedures access Order table"</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <!-- Status Bar -->
  <footer id="status-bar">
    <div id="status-message"></div>
    <div id="session-info"></div>
  </footer>

  <script type="module" src="/static/app.js"></script>
  <script type="module" src="/static/markdown_diff.js"></script>
  <script type="module" src="/static/diagram.js"></script>
  <script type="module" src="/static/cluster.js"></script>

  <!-- Initialize app after all modules are loaded -->
  <script>
    // Wait for all modules to finish loading and exporting their functions
    window.addEventListener('load', () => {
      if (typeof window.initApp === 'function') {
        window.initApp();
      }
    });
  </script>
</body>
</html>
